---
# https://taskfile.dev
version: '3'

vars:
  REPO_ROOT:
    sh: git rev-parse --show-toplevel
  K8S_ROOT: "{{.ROOT_DIR}}/kubernetes"

tasks:
  default:
    silent: true
    cmds:
      - task -l

  brew:
    desc: Install local dependencies with brew
    preconditions:
      - which brew
    cmds:
      - brew bundle --file Brewfile --no-lock

  yamlfmt:
    desc: Format YAML files
    silent: true
    preconditions:
      - which yamlfmt
    cmds:
      - find $(git rev-parse --show-toplevel) -type f \( -name "*.yaml" \) -exec sh -c 'yamlfmt -conf $(git rev-parse --show-toplevel)/.yamlfmt "$1"' _ {} \;

includes:
  nas: ./.taskfiles/nas/Taskfile.yaml
  k8s:
    taskfile: ./.taskfiles/k8s/Taskfile.yaml
    dir: "{{.K8S_ROOT}}"
