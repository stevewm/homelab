---
# https://taskfile.dev
version: '3'
tasks:
  bootstrap:
    desc: Bootstraps a cluster. CLUSTER_NAME must be set.
    cmds:
      - ./${CLUSTER_NAME}/bootstrap.sh
    requires:
      vars: [CLUSTER_NAME]
  shutdown:
    desc: Shuts down all Talos nodes
    cmds:
      - talosctl shutdown --nodes {{.NODE_IPS}}
    vars:
      NODE_IPS:
        sh: cat ${TALOSCONFIG} | yq -r '.contexts.{{.CLUSTER_NAME}}.endpoints[]' | paste -sd, -
    requires:
      vars: [TALOSCONFIG, CLUSTER_NAME]
